{"version":3,"sources":["webpack:///./src/Classes/PitchDetect.js","webpack:///src/components/Pitch.vue","webpack:///./src/components/Pitch.vue?e093","webpack:///./src/components/Pitch.vue"],"names":["window","AudioContext","webkitAudioContext","detectorElem","waveCanvas","pitchElem","noteElem","detuneElem","detuneAmount","audioContext","isPlaying","sourceNode","analyser","DEBUGCANVAS","mediaStreamSource","error","alert","gotStream","stream","createMediaStreamSource","createAnalyser","fftSize","connect","updatePitch","toggleLiveInput","stop","cancelAnimationFrame","webkitCancelAnimationFrame","rafID","dictionary","callback","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","e","audio","mandatory","googEchoCancellation","googAutoGainControl","googNoiseSuppression","googHighpassFilter","optional","onload","Math","max","floor","sampleRate","XMLHttpRequest","document","getElementById","getContext","strokeStyle","lineWidth","ondragenter","this","classList","add","ondragleave","remove","ondrop","preventDefault","reader","FileReader","event","decodeAudioData","target","result","buffer","onerror","readAsArrayBuffer","dataTransfer","files","buf","Float32Array","noteStrings","centsOffFromPitch","frequency","note","log","pow","frequencyFromNoteNumber","pitch","detune","time","Array","getFloatTimeDomainData","noteNum","ac","SIZE","length","rms","i","val","sqrt","r1","r2","abs","slice","c","fill","j","d","maxval","maxpos","T0","x1","x2","x3","a","autoCorrelate","clearRect","beginPath","moveTo","lineTo","stroke","className","innerText","round","innerHTML","requestAnimationFrame","webkitRequestAnimationFrame","Pitch","data","piano","Piano","timer","mounted","methods","getNote","_this","setInterval","octave","play","clearInterval","components_Pitch","render","_vm","_h","$createElement","_c","_self","attrs","color","on","click","_v","_m","_s","staticRenderFns","staticClass","id","width","height","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/2.88a9318414052db6c4d0.js","sourcesContent":["/*\nThe MIT License (MIT)\n\nCopyright (c) 2014 Chris Wilson\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nwindow.AudioContext = window.AudioContext || window.webkitAudioContext;\n\nvar MAX_SIZE = null\nvar audioContext = null;\nvar isPlaying = false;\nvar sourceNode = null;\nvar analyser = null;\nvar theBuffer = null;\nvar DEBUGCANVAS = null;\nvar mediaStreamSource = null;\nvar detectorElem, \n\tcanvasElem,\n\twaveCanvas,\n\tpitchElem,\n\tnoteElem,\n\tdetuneElem,\n\tdetuneAmount;\n\nwindow.onload = function() {\n\taudioContext = new AudioContext();\n\tMAX_SIZE = Math.max(4,Math.floor(audioContext.sampleRate/5000));\t// corresponds to a 5kHz signal\n\tvar request = new XMLHttpRequest();\n\t// request.open(\"GET\", \"../sounds/whistling3.ogg\", true);\n\t// request.responseType = \"arraybuffer\";\n\t// request.onload = function() {\n\t//   audioContext.decodeAudioData( request.response, function(buffer) { \n\t//     \ttheBuffer = buffer;\n\t// \t} );\n\t// }\n\t// request.send();\n\n\tdetectorElem = document.getElementById( \"detector\" );\n\tcanvasElem = document.getElementById( \"output\" );\n\tDEBUGCANVAS = document.getElementById( \"waveform\" );\n\tif (DEBUGCANVAS) {\n\t\twaveCanvas = DEBUGCANVAS.getContext(\"2d\");\n\t\twaveCanvas.strokeStyle = \"black\";\n\t\twaveCanvas.lineWidth = 1;\n\t}\n\tpitchElem = document.getElementById( \"pitch\" );\n\tnoteElem = document.getElementById( \"note\" );\n\tdetuneElem = document.getElementById( \"detune\" );\n\tdetuneAmount = document.getElementById( \"detune_amt\" );\n\n\tdetectorElem.ondragenter = function () { \n\t\tthis.classList.add(\"droptarget\"); \n\t\treturn false; };\n\tdetectorElem.ondragleave = function () { this.classList.remove(\"droptarget\"); return false; };\n\tdetectorElem.ondrop = function (e) {\n  \t\tthis.classList.remove(\"droptarget\");\n  \t\te.preventDefault();\n\t\ttheBuffer = null;\n\n\t  \tvar reader = new FileReader();\n\t  \treader.onload = function (event) {\n\t  \t\taudioContext.decodeAudioData( event.target.result, function(buffer) {\n\t    \t\ttheBuffer = buffer;\n\t  \t\t}, function(){alert(\"error loading!\");} ); \n\n\t  \t};\n\t  \treader.onerror = function (event) {\n\t  \t\talert(\"Error: \" + reader.error );\n\t\t};\n\t  \treader.readAsArrayBuffer(e.dataTransfer.files[0]);\n\t  \treturn false;\n\t};\n\n\n\n}\n\nfunction error() {\n    alert('Stream generation failed.');\n}\n\nfunction getUserMedia(dictionary, callback) {\n    try {\n        navigator.getUserMedia = \n        \tnavigator.getUserMedia ||\n        \tnavigator.webkitGetUserMedia ||\n        \tnavigator.mozGetUserMedia;\n        navigator.getUserMedia(dictionary, callback, error);\n    } catch (e) {\n        alert('getUserMedia threw exception :' + e);\n    }\n}\n\nfunction gotStream(stream) {\n    // Create an AudioNode from the stream.\n    mediaStreamSource = audioContext.createMediaStreamSource(stream);\n\n    // Connect it to the destination.\n    analyser = audioContext.createAnalyser();\n    analyser.fftSize = 2048;\n    mediaStreamSource.connect( analyser );\n    updatePitch();\n}\n\nfunction toggleOscillator() {\n    if (isPlaying) {\n        //stop playing and return\n        sourceNode.stop( 0 );\n        sourceNode = null;\n        analyser = null;\n        isPlaying = false;\n\t\tif (!window.cancelAnimationFrame)\n\t\t\twindow.cancelAnimationFrame = window.webkitCancelAnimationFrame;\n        window.cancelAnimationFrame( rafID );\n        return \"play oscillator\";\n    }\n    sourceNode = audioContext.createOscillator();\n\n    analyser = audioContext.createAnalyser();\n    analyser.fftSize = 2048;\n    sourceNode.connect( analyser );\n    analyser.connect( audioContext.destination );\n    sourceNode.start(0);\n    isPlaying = true;\n    isLiveInput = false;\n    updatePitch();\n\n    return \"stop\";\n}\n\nexport function toggleLiveInput() {\n    if (isPlaying) {\n        //stop playing and return\n        sourceNode.stop( 0 );\n        sourceNode = null;\n        analyser = null;\n        isPlaying = false;\n\t\tif (!window.cancelAnimationFrame)\n\t\t\twindow.cancelAnimationFrame = window.webkitCancelAnimationFrame;\n        window.cancelAnimationFrame( rafID );\n    }\n    getUserMedia(\n    \t{\n            \"audio\": {\n                \"mandatory\": {\n                    \"googEchoCancellation\": \"false\",\n                    \"googAutoGainControl\": \"false\",\n                    \"googNoiseSuppression\": \"false\",\n                    \"googHighpassFilter\": \"false\"\n                },\n                \"optional\": []\n            },\n        }, gotStream);\n}\n\nfunction togglePlayback() {\n    if (isPlaying) {\n        //stop playing and return\n        sourceNode.stop( 0 );\n        sourceNode = null;\n        analyser = null;\n        isPlaying = false;\n\t\tif (!window.cancelAnimationFrame)\n\t\t\twindow.cancelAnimationFrame = window.webkitCancelAnimationFrame;\n        window.cancelAnimationFrame( rafID );\n        return \"start\";\n    }\n\n    sourceNode = audioContext.createBufferSource();\n    sourceNode.buffer = theBuffer;\n    sourceNode.loop = true;\n\n    analyser = audioContext.createAnalyser();\n    analyser.fftSize = 2048;\n    sourceNode.connect( analyser );\n    analyser.connect( audioContext.destination );\n    sourceNode.start( 0 );\n    isPlaying = true;\n    isLiveInput = false;\n    updatePitch();\n\n    return \"stop\";\n}\n\nvar rafID = null;\nvar tracks = null;\nvar buflen = 2048;\nvar buf = new Float32Array( buflen );\n\nvar noteStrings = [\"C\", \"C#\", \"D\", \"D#\", \"E\", \"F\", \"F#\", \"G\", \"G#\", \"A\", \"A#\", \"B\"];\n\nexport function noteFromPitch( frequency ) {\n\tvar noteNum = 12 * (Math.log( frequency / 440 )/Math.log(2) );\n\treturn Math.round( noteNum ) + 69;\n}\n\nfunction frequencyFromNoteNumber( note ) {\n\treturn 440 * Math.pow(2,(note-69)/12);\n}\n\nfunction centsOffFromPitch( frequency, note ) {\n\treturn Math.floor( 1200 * Math.log( frequency / frequencyFromNoteNumber( note ))/Math.log(2) );\n}\n\nfunction autoCorrelate( buf, sampleRate ) {\n\t// Implements the ACF2+ algorithm\n\tvar SIZE = buf.length;\n\tvar rms = 0;\n\n\tfor (var i=0;i<SIZE;i++) {\n\t\tvar val = buf[i];\n\t\trms += val*val;\n\t}\n\trms = Math.sqrt(rms/SIZE);\n\tif (rms<0.01) // not enough signal\n\t\treturn -1;\n\n\tvar r1=0, r2=SIZE-1, thres=0.2;\n\tfor (var i=0; i<SIZE/2; i++)\n\t\tif (Math.abs(buf[i])<thres) { r1=i; break; }\n\tfor (var i=1; i<SIZE/2; i++)\n\t\tif (Math.abs(buf[SIZE-i])<thres) { r2=SIZE-i; break; }\n\n\tbuf = buf.slice(r1,r2);\n\tSIZE = buf.length;\n\n\tvar c = new Array(SIZE).fill(0);\n\tfor (var i=0; i<SIZE; i++)\n\t\tfor (var j=0; j<SIZE-i; j++)\n\t\t\tc[i] = c[i] + buf[j]*buf[j+i];\n\n\tvar d=0; while (c[d]>c[d+1]) d++;\n\tvar maxval=-1, maxpos=-1;\n\tfor (var i=d; i<SIZE; i++) {\n\t\tif (c[i] > maxval) {\n\t\t\tmaxval = c[i];\n\t\t\tmaxpos = i;\n\t\t}\n\t}\n\tvar T0 = maxpos;\n\n\tvar x1=c[T0-1], x2=c[T0], x3=c[T0+1],\n\ta = (x1 + x3 - 2*x2)/2,\n\tb = (x3 - x1)/2;\n\tif (a) T0 = T0 - b/(2*a);\n\n\treturn sampleRate/T0;\n}\nexport let pitch = null;\nexport let note = null;\nexport let detune = null;\n\n\nexport function updatePitch( time ) {\n    var cycles = new Array;\n    if(!analyser)\n        return\n\tanalyser.getFloatTimeDomainData( buf );\n\tvar ac = autoCorrelate( buf, audioContext.sampleRate );\n\t// TODO: Paint confidence meter on canvasElem here.\n\n\tif (DEBUGCANVAS) {  // This draws the current waveform, useful for debugging\n\t\twaveCanvas.clearRect(0,0,512,256);\n\t\twaveCanvas.strokeStyle = \"red\";\n\t\twaveCanvas.beginPath();\n\t\twaveCanvas.moveTo(0,0);\n\t\twaveCanvas.lineTo(0,256);\n\t\twaveCanvas.moveTo(128,0);\n\t\twaveCanvas.lineTo(128,256);\n\t\twaveCanvas.moveTo(256,0);\n\t\twaveCanvas.lineTo(256,256);\n\t\twaveCanvas.moveTo(384,0);\n\t\twaveCanvas.lineTo(384,256);\n\t\twaveCanvas.moveTo(512,0);\n\t\twaveCanvas.lineTo(512,256);\n\t\twaveCanvas.stroke();\n\t\twaveCanvas.strokeStyle = \"black\";\n\t\twaveCanvas.beginPath();\n\t\twaveCanvas.moveTo(0,buf[0]);\n\t\tfor (var i=1;i<512;i++) {\n\t\t\twaveCanvas.lineTo(i,128+(buf[i]*128));\n\t\t}\n\t\twaveCanvas.stroke();\n\t}\n\n \tif (ac == -1) {\n \t\tdetectorElem.className = \"vague\";\n\t \tpitchElem.innerText = \"--\";\n\t\tnoteElem.innerText = \"-\";\n\t\tdetuneElem.className = \"\";\n\t\tdetuneAmount.innerText = \"--\";\n \t} else {\n\t \tdetectorElem.className = \"confident\";\n\t \tpitch = ac;\n\t \tpitchElem.innerText = Math.round( pitch ) ;\n\t \tnote =  noteFromPitch( pitch );\n\t\tnoteElem.innerHTML = noteStrings[note%12];\n\t\tdetune = centsOffFromPitch( pitch, note );\n\t\tif (detune == 0 ) {\n\t\t\tdetuneElem.className = \"\";\n\t\t\tdetuneAmount.innerHTML = \"--\";\n\t\t} else {\n\t\t\tif (detune < 0)\n\t\t\t\tdetuneElem.className = \"flat\";\n\t\t\telse\n\t\t\t\tdetuneElem.className = \"sharp\";\n\t\t\tdetuneAmount.innerHTML = Math.abs( detune );\n        }\n\t}\n\n\tif (!window.requestAnimationFrame)\n\t\twindow.requestAnimationFrame = window.webkitRequestAnimationFrame;\n    rafID = window.requestAnimationFrame( updatePitch );\n    return {\n        note: noteStrings[note%12],\n        pitch: Math.round( pitch ), \n        detune: Math.abs( detune ),\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Classes/PitchDetect.js","<template>\n    <div>\n<p>\n\t\t\t<!-- <button onclick=\"this.innerText = togglePlayback()\">use demo audio</button> -->\n\t\t\t<!-- <button onclick=\"toggleLiveInput()\">use live input</button> -->\n            <v-btn color=\"\" @click=\"toggleLiveInput\">use live input</v-btn>\n            <v-btn @click=\"getNote\">get Note</v-btn>\n\t\t\t<!-- <button onclick=\"toggleOscillator()\">use oscillator</button> -->\n\t\t\t<!--<button onclick=\"updatePitch(0);\">sample</button>-->\n\t\t</p>\n\n\t\t<div id=\"detector\" class=\"vague\">\n\t\t\t<div class=\"pitch\"><span id=\"pitch\">--</span>Hz</div>\n\t\t\t<div class=\"note\"><span id=\"note\">--</span></div>   \n\t\t\t<canvas id=\"output\" width=300 height=42></canvas>\n\t\t\t<div id=\"detune\"><span id=\"detune_amt\">--</span><span id=\"flat\">cents &#9837;</span><span id=\"sharp\">cents &#9839;</span></div>\n\t\t</div>\n                    <span >Note: {{pitch.note}}</span>\n                    <br>\n            <span >Frquency: {{pitch.pitch}}</span>\n            <br>\n            <span >Cents: {{pitch.detune}}</span>\n            <br>\n            <v-btn color=\"purple\" @click=\"stop\">Stop</v-btn>\n\n    </div>\n</template>\n<script>\nimport {\n    toggleLiveInput,\n    noteFromPitch,\n    updatePitch\n} from './../Classes/PitchDetect'\nimport piano from './../Classes/Piano'\nexport default {\n    data() {\n        return {\n            toggleLiveInput,\n            pitch: {\n                note: \"-\",\n                pitch: \"-\",\n                detune: \"-\"\n            },\n            piano,\n            timer: null,\n        }\n    },\n    mounted() {\n        updatePitch()\n    },\n    methods: {\n        getNote() {\n            let count = 0\n            this.timer = setInterval(() => {\n                this.pitch = updatePitch()\n                let octave\n                    if (this.pitch.pitch > 33 && this.pitch.pitch < 63)\n                        octave = 1\n                    else if (this.pitch.pitch >= 63 && this.pitch.pitch <= 134)\n                        octave = 3\n                    else if (this.pitch.pitch > 134 && this.pitch.pitch < 269)\n                        octave = 4\n                    else if (this.pitch.pitch >= 269 && this.pitch.pitch <= 510)\n                        octave = 5\n                    else if (this.pitch.pitch > 510 && this.pitch.pitch < 1075)\n                        octave = 5\n                    else\n                        octave = 3\n                this.piano.note(this.pitch.note + octave + \"q\").play()\n\n                // count += 50\n                \n                //     this.piano.note(this.pitch.note + octave + \"q\").play()\n                //     count = 0\n                // }\n\n            }, 1000)\n            // this.timer = setInterval(()=> {\n            // this.piano.note(this.pitch.note + \"3q\").play()\n            // }, 1000)\n        },\n        stop() {\n            clearInterval(this.timer)\n        }\n    }\n}\n</script>\n\n<style>\n\t\t\tbody { font: 14pt 'Alike', sans-serif;}\n\t\t\t#note { font-size: 164px; }\n\t\t\t.droptarget { background-color: #348781}\n\t\t\tdiv.confident { color: black; }\n\t\t\tdiv.vague { color: lightgrey; }\n\t\t\t#note { display: inline-block; height:180px; text-align: left;}\n\t\t\t\n\t\t\t#detector { width: 300px; height: 300px; border: 4px solid gray; border-radius: 8px; text-align: center; padding-top: 10px;}\n\t\t\t#output { width: 300px; height: 42px; }\n\t\t\t#flat { display: none; }\n\t\t\t#sharp { display: none; }\n\t\t\t.flat #flat { display: inline; }\n\t\t\t.sharp #sharp { display: inline; }\n\t\t</style>\n\n\n// WEBPACK FOOTER //\n// src/components/Pitch.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('p',[_c('v-btn',{attrs:{\"color\":\"\"},on:{\"click\":_vm.toggleLiveInput}},[_vm._v(\"use live input\")]),_vm._v(\" \"),_c('v-btn',{on:{\"click\":_vm.getNote}},[_vm._v(\"get Note\")])],1),_vm._v(\" \"),_vm._m(0),_vm._v(\" \"),_c('span',[_vm._v(\"Note: \"+_vm._s(_vm.pitch.note))]),_vm._v(\" \"),_c('br'),_vm._v(\" \"),_c('span',[_vm._v(\"Frquency: \"+_vm._s(_vm.pitch.pitch))]),_vm._v(\" \"),_c('br'),_vm._v(\" \"),_c('span',[_vm._v(\"Cents: \"+_vm._s(_vm.pitch.detune))]),_vm._v(\" \"),_c('br'),_vm._v(\" \"),_c('v-btn',{attrs:{\"color\":\"purple\"},on:{\"click\":_vm.stop}},[_vm._v(\"Stop\")])],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"vague\",attrs:{\"id\":\"detector\"}},[_c('div',{staticClass:\"pitch\"},[_c('span',{attrs:{\"id\":\"pitch\"}},[_vm._v(\"--\")]),_vm._v(\"Hz\")]),_vm._v(\" \"),_c('div',{staticClass:\"note\"},[_c('span',{attrs:{\"id\":\"note\"}},[_vm._v(\"--\")])]),_vm._v(\" \"),_c('canvas',{attrs:{\"id\":\"output\",\"width\":\"300\",\"height\":\"42\"}}),_vm._v(\" \"),_c('div',{attrs:{\"id\":\"detune\"}},[_c('span',{attrs:{\"id\":\"detune_amt\"}},[_vm._v(\"--\")]),_c('span',{attrs:{\"id\":\"flat\"}},[_vm._v(\"cents ♭\")]),_c('span',{attrs:{\"id\":\"sharp\"}},[_vm._v(\"cents ♯\")])])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-6ab67a82\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Pitch.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-6ab67a82\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Pitch.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Pitch.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Pitch.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-6ab67a82\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Pitch.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Pitch.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}